<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://unpkg.com/viz.js@1.8.2/viz.js" type="javascript/worker"></script>
<script src="https://unpkg.com/d3-graphviz@2.6.1/build/d3-graphviz.js"></script>
<script src="./inflate.js" type="text/javascript"></script>

<input type="button" value="new window open" onclick="buttonClick()">
<div id="graph"></div>
<script>
    // URLを取得
    let url = new URL(window.location.href);

    // URLSearchParamsオブジェクトを取得
    let params = url.searchParams;

    // URLパラメータ（digraph）を取得
    let digraph = params.get('digraph');

    // 参考：高度なJavaScript技集（http://www33146ue.sakura.ne.jp/staff/iz/amuse/javascript/expert/）
    digraph = atob(digraph); // base64デコード
    digraph = zip_inflate(digraph);  // 復号化
    digraph = decodeURIComponent(digraph); // UTF8 → UTF16
    console.log(digraph);

    d3.select("#graph").graphviz()
        .fade(false)
        .zoom(false)
        .renderDot(digraph);



    // ボタン押下で、別タブを表示
    function buttonClick(){
        window.open(window.location.href, '_blank');
    }
</script>